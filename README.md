# PriceComparer

Исходные данные
База данных Microsoft SQL Server 2008 в составе:
- PRICES – таблица прайс-листов;
- PRICESRECORDS – таблица записей прайс-листов;
- DISTRIBUTORS – таблица поставщиков (контрагентов);
- LINKS – таблица связей записей прайс-листов с товарными позициями;
- PRODUCTS – таблица товаров.

Основная цель:
Путем сравнения цен прайс-листов разных поставщиков с базовым прайс-листом (выбранным пользователем) получить сравнительную характеристику цен базового прайс-листа по отношению к другим. Основным показателям будет минимальная цена по прайс-листам.

Общая информация:
База данных содержит информацию о товарах и поставщиках этих товаров. Вся информация о товарах храниться в таблице PRODUCTS (номенклатура товаров). Товары связаны с прайс-листами поставщиков. Связи товаров и записей прайс-листов хранятся в таблице LINKS. Один товар может быть связан с несколькими прайс-листами разных поставщиков.
Связь товаров и записей прайс-листов:
(PRODUCTS.ID = LINKS. CATALOGPRODUCTID)
(LINKS. PRICERECORDINDEX = PRICESRECORDS. RECORDINDEX)
Связь записей прайс-листов и прайс-листов:
PRICESRECORDS. PRICEID = PRICES.ID
Связь прайс-листов и поставщиков:
PRICES. DISID = DISTRIBUTORS.ID
Подробную информацию о всех полях в таблицах не даю, она интуитивно понятны и большинство из них не нужны для анализа. Основные поля описаны ниже.
Таблица DISTRIBUTORS:
ACTIVE – активен / не активен;
NAME – наименование товара;
Таблица PRICES:
ISACTIVE – активен / не активен;
	NAME – наименование товара;
	DEFAULTCURRENCY – валюта;
PRICE – стоимость товара по прайс-листу;
USED – используется / не используется;
DELETED – удалена / не удалена.
Таблица PRODUCTS:
	NAME – наименование родительского товара;
CHILDNAME – наименование дочернего товара;
PRICE – стоимость товара по каталогу;
DEFAULTCURRENCY – валюта;

Задание
Разработать форму для анализа прайс-листов.
Форма должна содержать следующие элементы управления:
1. Панель управления (top):
- список поставщиков;
- список прайс-листов (для выбранного поставщика);
- список с выбором критерия для выполнения анализа: Все (значение по умолчанию), Минимальная цена у других, Минимальная цена здесь;
- кнопка «Выполнить анализ»
2. Таблица 1 с товарами из выбранного прайс-листа: Наименование товара, Цена, Минимальная цена, Разница, Максимальная цена, Разница, Поставщик, Прайс-лист, Примечание.
3. Таблица 2 с записями прайс-листов, связанных с выбранным товаром в Таблице 1: Поставщик, Прайс-лист, Наименование товара, Цена, Разница.

Алгоритм работы с формой:
Пользователь из списка поставщиков выбирает нужного. После этого в список прайс-листов загружаются соответственно прайс-листы выбранного поставщика. Затем из списка прайс-листов пользователь выбирает нужный (далее базовый). Указывает из списка критериев для анализа нужный. Нажимает кнопку «Выполнить анализ».
Выполнение анализа.
П.1 Выполняется загрузка товарных позиций (из таблицы PRODUCTS), с которыми связаны записи базового прайс-листа. 
П.2 Выполняется загрузка записей других прайс-листов (за исключением базового), которые связанны с выбранными в п.1 товарами.
Важно! В анализе принимают участие только те прайс-листы, у которых поля USED = 1, DELETED = 0, ISACTIVE = 1, и у поставщиков которых поле ACTIVE = 1.
П.3 Товары выводятся в таблицу 1 (Наименование товара, Цена). Наименование в этой таблице это наименования из таблицы PRODUCTS по формуле NAME + “ “ + CHILDNAME. Цена, это цена товара из базового прайс-листа (PRICESRECORDS.PRICE). Остальные колонки заполняются исходя из заданного критерия для анализа.
П.4.1 Для критерия Все
В поле Минимальная цена выводится соответственно минимальная цена из других прайс-листов, а в поле Разница соответственно разница с базовой ценой (с указанием знака +-). Если минимальная цена из других прайс-листов меньше базовой цены, подсветить ее зеленым цветом, а базовую красным.
Остальные поля заполняются исходя из записей прайс-листов.
П.4.2 Для критерия Минимальная цена у других
В поле Минимальная цена выводится соответственно минимальная цена из других прайс-листов, которая меньше базовой. Если минимальная цена, которая меньше базовой, не найдена, поле оставлять пустым. В поле Разница соответственно разница с базовой ценой (с указанием знака +-). Если минимальная цена из других прайс-листов меньше базовой цены, подсветить ее зеленым цветом, а базовую красным.
П.4.3 Для критерия Минимальная цена здесь
В поле Минимальная цена выводится соответственно минимальная цена из других прайс-листов. В поле Разница соответственно разница с базовой ценой (с указанием знака +-). Если минимальная цена, которая меньше базовой, не найдена, подсветить базовую цену зеленым. Если минимальная цена из других прайс-листов меньше базовой цены, подсветить базовую цену красным.

Примечание: Если минимальная цена принадлежит нескольким прайс-листам, то в поля Прайс-Лист и Поставщик выводим информацию о любом из этих прайс-листов, а перечень других прайс-листов выводится в поле Примечание.
П. 5 При выделении товарной позиции в Таблице 1 заполняется Таблица 2.
В таблицу 2 выводятся все записи прайс-листов, связанные с выделенным товаром. Сортировка по возрастанию цены. Первой строкой всегда выводится запись из базового прайс-листа (выделить цветом). Наименование в этой таблице это наименование из таблицы PRICESRECORDS. NAME. Выделить зеленым цветом те записи, цена которых меньше базовой цены.
